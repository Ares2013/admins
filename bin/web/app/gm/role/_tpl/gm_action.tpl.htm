<form class="am-form">
  <fieldset>

        <?php
        $input_params = '';
        foreach($fields as $k =>$v){
        $input_params .= $k.': $(":input[name=\'param_'.$k.'\']").val(),';
        if(isset($v['options']) && count($v['options']) > 0){
            echo '<div class="am-form-group"><label>'.$v['name'].'：<small>'.$v['tips'].'</small></label>';
            echo '<select name="param_'.$k.'" '.$v['attr'].'>';
                foreach($v['options'] as $opt_k => $opt_v){
                    echo '<option value="'.$opt_k.'">'.$opt_v.'</option>';
                }
            echo '</select><span class="am-form-caret"></span></div>';
        }else{
            echo '<div class="am-form-group"><label>'.$v['name'].'：<small>'.$v['tips'].'</small></label><input type="text" name="param_'.$k.'" '.$v['attr'].'/></div>';
        }
        }
        ?>
        <p><button onclick="javascript:gm_action();return false;" id="gm_action_button" type="submit" class="am-btn am-btn-default">确定</button></p>

  </fieldset>
</form>

<script>
    function gm_action(){
        var params = {
            <?php
            echo $input_params;
            foreach($params as $k => $v){
                echo $k.': '.$v.',';
            }
            ?>
            mod: "<?php echo $this->input['mod'];?>",
            act: "<?php echo $this->input['act'];?>",
            id: "<?php echo $this->input['id'];?>",
            op: 1,
            rand: Math.random()
        };
        gm_action_do("<?php echo $_SERVER['SCRIPT_NAME']; ?>", params, 300)
    }
</script>
<script type="text/javascript" src="assets/js/data_items.js"></script>

<script>

var items = data_items;

$( "#itemid" ).autocomplete({
    source: items,
    close: function( event, ui ) {
        var o = $("#itemid").val();
        var i = o.indexOf(" ")
        if(i > 0){
            var v = o.substr(0, i);
            $("#itemid").val(v);
        }
    }
});
</script>
