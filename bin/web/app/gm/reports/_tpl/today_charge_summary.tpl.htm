<?php $this->setLayout('amazeui');?>

<?php $this->block('title');?>今日充值概况<?php $this->endBlock('title');?>

<?php $this->block('content');?>
<script src="assets/js/jquery.tablesort.js"></script>
<style type="text/css">

th {
    cursor: pointer;
}

th:hover,
th.sorted.ascending:after {
    content: "  \2191";
}

th.sorted.descending:after {
    content: " \2193";
}

</style>

<form id="mainForm" method="post" class="am-form">
    <?php foreach($_GET as $k => $v):?>
    <?php if($k == 'kw') continue;?>
    <?php if($k == 'page') continue;?>
    <input type="hidden" name="<?php echo $k;?>" value="<?php echo $v;?>" />
    <?php endforeach;?>
    
    <input type="hidden" name="submit_type" value="" id="submit_type">
    <!-- panel start -->
    <div class="am-panel am-panel-default">
      <div class="am-panel-hd am-cf" data-am-collapse="{target: '#collapse-panel-search'}">选项<span class="am-icon-chevron-down am-fr" ></span></div>
      <div class="am-panel-bd am-collapse am-in" id="collapse-panel-search">

          <?php 
          $ps = Game::getPlatformsServers();
          $platformsOpt = array();
          foreach($ps as $pid => $servers):
          ?>
          <div class="am-g">
              <div class="am-u-sm-12 am-u-md-12">
                  <div class="am-form-group">
                      <label class="am-text-sm"><?php echo Game::platform($pid); ?>平台：</label>
                      <label class="am-checkbox-inline am-text-warning">
                          <input type="checkbox" id="platform-<?php echo $pid;?>"  onclick="sel('<?php echo $pid;?>');">全选</label>
                      <?php 
                      foreach($servers as $sid => $name):
                      $name =  $name. '区';
                      $key = "servers[{$pid}][{$sid}]";
                      $checked = isset($serv[$pid][$sid]) ? 'checked="true"' : '';//这里的isset判断记得改成act页面获取的表单值的数组
                      echo '<label class="am-checkbox-inline"><input '.$checked.' class="platform-'.$pid.'" type="checkbox" name="'.$key.'" value="1">'.$name.'</label>';
                      endforeach;
                      ?>
                  </div>
              </div>
          </div>
          <?php endforeach; ?>


          <div class="am-g">
              <div class="am-u-sm-12 am-u-md-12 am-u-end">
                  <button onclick="$('#submit_type').val('search')" class="am-btn am-btn-default am-input-sm" type="submit">确定</button>
              </div>
          </div>

      </div>
    </div>

    <!-- panel end -->


<?php foreach($data as $pid=>$servers):?>

<div class="am-panel am-panel-default">
    <div class="am-panel-hd">
        <h3 class="am-panel-title">充值概况 - <?php echo Game::platform($pid);?></h3>
    </div>
    <table class="am-table-bordered am-table am-table-compact am-text-xs am-table-centered">
        <thead>

            <tr>
                <th class="number am-success am-text-nowrop am-text-middle">分区</th>
                <th class="number am-hide-sm-only am-active am-text-nowrop">订单数</th>
                <th class="number am-hide-sm-only am-active am-text-nowrop">付费人数(二次)</th>
                <th class="number am-hide-sm-only am-active am-text-nowrop">总游戏币</th>
                <th class="number am-active am-text-nowrop">总金额</th>
            </tr>
        </thead>
        <tbody>
        
        <?php foreach($servers as $sid=>$server):?>
        
        <tr>
            <td class="am-success am-text-center"><?php echo $sid;?></td>
            <td class="am-hide-sm-only am-active am-text-center"><?php echo $server['orders'];?></td>
            <td class="am-hide-sm-only am-active am-text-center"><?php echo $server['players'].'('.$server['players2'].')';?></td>
            <td class="am-hide-sm-only am-active am-text-center"><?php echo $server['moneyGameAll'];?></td>
            <td class="am-active am-text-center"><?php echo $server['moneyAll'];?></td>
			<?php $sum_orders += $server['orders']; 
				  $sum_players += $server['players'];
				  $sum_players2 += $server['players2'];
				  $sum_moneyGameAll += $server['moneyGameAll'];
				  $sum_moneyAll += $server['moneyAll'];
			 ?>
        </tr>

        <?php endforeach;?>
        </tbody>
    </table>
</div>


<?php endforeach;?>
<?php if($data){ ?>
    <table  class="am-table-bordered am-table am-table-compact am-text-xs am-table-centered">
      <thead>
          <tr>
          <th class="number am-success am-text-nowrop am-text-middle">订单总数</th>
          <th class="number am-success am-text-nowrop am-text-middle">付费玩家总数(二次)</th>
          <th class="number am-success am-text-nowrop am-text-middle">游戏币总数</th>
          <th class="number am-success am-text-nowrop am-text-middle">金额总数</th>
          </tr>
       </thead>
        <tr>
            <td class="am-active am-text-center"><?php echo $sum_orders; ?></td>
            <td class="am-active am-text-center"><?php echo $sum_players.'('.$sum_players2.')'; ?></td>
            <td class="am-active am-text-center"><?php echo $sum_moneyGameAll; ?></td>
            <td class="am-active am-text-center"><?php echo $sum_moneyAll; ?></td>
        </tr>
    </table>
 <?php } ?>
</form>

<script type="text/javascript">

	$(function() {

		$('table').tablesort().data('tablesort');
		$('thead th.number').data('sortBy', function(th, td, sorter) {
			return parseInt(td.text(), 10);
		});

	});

	function sel(pid) {
	    var id = "platform-"+pid;
	    if($('#'+id).prop("checked")){
	        $('.'+id).prop("checked", true);
	        //$('#'+id).prop("checked",true)
	    }else{
	        $('.'+id).prop("checked", false);
	    }
	}
	
</script>

<?php $this->endBlock('content');?>
