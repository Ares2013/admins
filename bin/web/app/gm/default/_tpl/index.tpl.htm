<?php $this->setLayout('amazeui');?>

<?php $this->block('title');?>首页<?php $this->endBlock('title');?>

<?php $this->block('content');?>
<script src="assets/js/jquery.tablesort.js"></script>
<style type="text/css">

th {
    cursor: pointer;
}

th:hover,
th.sorted.ascending:after {
    content: "  \2191";
}

th.sorted.descending:after {
    content: " \2193";
}

</style>
<?php foreach($data as $pid=>$servers):?>
<div class="am-panel am-panel-default">
    <div class="am-panel-hd">
        <h3 class="am-panel-title">充值概况 - <?php echo Game::platform($pid);?></h3>
    </div>
    <table class="am-table-bordered am-table am-table-compact am-text-xs am-table-centered">
        <thead>
            <tr>
                <th class="am-success am-text-nowrop am-text-middle">-</th>
                <th class="am-hide-sm-only am-active am-text-nowrop" colspan="4">今天</th>
                <th class="am-hide-sm-only am-primary am-text-nowrop" colspan="4">昨天</th>
                <!--
                <th class="am-hide-sm-only number am-active am-text-nowrop" colspan="4">一周</th>
                <th class="am-hide-sm-only number am-warning am-text-nowrop" colspan="4">全部</th>
                -->
            </tr>
            <tr>
                <th class="number am-success am-text-nowrop am-text-middle" rowspan="2">分区</th>
                <th class="number am-hide-sm-only am-active am-text-nowrop">订单数</th>
                <th class="number am-hide-sm-only am-active am-text-nowrop">付费人数(二次)(三次)</th>
                <th class="number am-hide-sm-only am-active am-text-nowrop">游戏币</th>
                <th class="number am-active am-text-nowrop">金额</th>
                <th class="number am-hide-sm-only am-primary am-text-nowrop">订单数</th>
                <th class="number am-hide-sm-only am-primary am-text-nowrop">付费人数(二次)(三次)</th>
                <th class="number am-hide-sm-only am-primary am-text-nowrop">总游戏币</th>
                <th class="number am-primary am-text-nowrop">金额</th>
                <!--
                <th class="number am-hide-sm-only am-active am-text-nowrop">订单数</th>
                <th class="number am-hide-sm-only am-active am-text-nowrop">付费人数(二次)</th>
                <th class="number am-hide-sm-only am-active am-text-nowrop">总游戏币</th>
                <th class="number am-active am-text-nowrop">总金额</th>
                <th class="number am-hide-sm-only am-warning am-text-nowrop">订单数</th>
                <th class="number am-hide-sm-only am-warning am-text-nowrop">付费人数(二次)</th>
                <th class="number am-hide-sm-only am-warning am-text-nowrop">总游戏币</th>
                <th class="number am-warning am-text-nowrop">总金额</th>
                -->
            </tr>
        </thead>
        <tbody>
        <?php

        $tgsid2lgsids = Config::getInstance($pid)->get('tgsid2lgsids');
        foreach($servers as $sid=>$server):
            if(isset($tgsid2lgsids[$sid])){
                $startSid = $tgsid2lgsids[$sid][0];
                $end = count($tgsid2lgsids[$sid]) - 1;
                $endSid = $tgsid2lgsids[$sid][$end];
                if($startSid == 2001) $startSid = 0;
                $name = $startSid.'~'.$endSid;
            }else{
                $name = $sid;
            }

        ?>
        <tr>
            <td class="am-success am-text-center"><?php echo $name;?></td>
            <td class="am-hide-sm-only am-active am-text-center"><?php echo $server['today']['orders'];?></td>
            <td class="am-hide-sm-only am-active am-text-center"><?php echo $server['today']['players'].'('.$server['today']['players2'].')'.'('.$server['today']['players3'].')';?></td>
            <td class="am-hide-sm-only am-active am-text-center"><?php echo $server['today']['moneyGameAll'];?></td>
            <td class="am-active am-text-center"><?php echo $server['today']['moneyAll'];?></td>
            <td class="am-hide-sm-only am-primary am-text-center"><?php echo $server['yesterday']['orders'];?></td>
            <td class="am-hide-sm-only am-primary am-text-center"><?php echo $server['yesterday']['players'].'('.$server['yesterday']['players2'].')'.'('.$server['yesterday']['players3'].')';?></td>
            <td class="am-hide-sm-only am-primary am-text-center"><?php echo $server['yesterday']['moneyGameAll'];?></td>
            <td class="am-primary am-text-center"><?php echo $server['yesterday']['moneyAll'];?></td>
            <!--
            <td class="am-hide-sm-only am-active am-text-center"><?php echo $server['week']['orders'];?></td>
            <td class="am-hide-sm-only am-active am-text-center"><?php echo $server['week']['players'].'('.$server['week']['players2'].')';?></td>
            <td class="am-hide-sm-only am-active am-text-center"><?php echo $server['week']['moneyGameAll'];?></td>
            <td class="am-active am-text-center"><?php echo $server['week']['moneyAll'];?></td>
            <td class="am-hide-sm-only am-warning am-text-center"><?php echo $server['all']['orders'];?></td>
            <td class="am-hide-sm-only am-warning am-text-center"><?php echo $server['all']['players'].'('.$server['all']['players2'].')';?></td>
            <td class="am-hide-sm-only am-warning am-text-center"><?php echo $server['all']['moneyGameAll'];?></td>
            <td class="am-warning am-text-center"><?php echo $server['all']['moneyAll'];?></td>
            -->
        <?php
            $sum_orders += $server['today']['orders'];
            $sum_players += $server['today']['players'];
            $sum_players2 += $server['today']['players2'];
            $sum_players3 += $server['today']['players3'];
            $sum_yb += $server['today']['moneyGameAll'];
            $sum_money += $server['today']['moneyAll'];

            $sum2_orders += $server['yesterday']['orders'];
            $sum2_players += $server['yesterday']['players'];
            $sum2_players2 += $server['yesterday']['players2'];
            $sum2_players3 += $server['yesterday']['players3'];
            $sum2_yb += $server['yesterday']['moneyGameAll'];
            $sum2_money += $server['yesterday']['moneyAll'];
        ?>

        </tr>
        <?php endforeach;?>
        </tbody>
    </table>
</div>
<?php endforeach;?>


<div class="am-panel am-panel-default">

    <div class="am-panel-hd">
        <h3 class="am-panel-title">以上总计</h3>
    </div>
    <table class="am-table-bordered am-table am-table-compact am-text-xs am-table-centered">
        <thead>
            <tr>
                <th class="am-hide-sm-only am-text-nowrop" colspan="4">今天</th>
                <th class="am-hide-sm-only am-text-nowrop" colspan="4">昨天</th>
            </tr>
            <tr class="am-success">
                <th class="number am-hide-sm-only am-text-nowrop">订单总数</th>
                <th class="number am-hide-sm-only am-text-nowrop">付费总人数(二次)(三次)</th>
                <th class="number am-hide-sm-only am-text-nowrop">游戏币总数</th>
                <th class="number am-text-nowrop">金额总数</th>
                <th class="number am-hide-sm-only am-text-nowrop">订单总数</th>
                <th class="number am-hide-sm-only am-text-nowrop">付费总人数(二次)(三次)</th>
                <th class="number am-hide-sm-only am-text-nowrop">游戏币总数</th>
                <th class="number am-text-nowrop">金额总数</th>
            </tr>
        </thead>
        <tbody>

        <tr class="am-success">
            <td class="am-hide-sm-only am-text-center"><?php echo $sum_orders;?></td>
            <td class="am-hide-sm-only am-text-center"><?php echo $sum_players.'('.$sum_players2.')' . '('.$sum_players3.')';?></td>
            <td class="am-hide-sm-only am-text-center"><?php echo $sum_yb;?></td>
            <td class="am-text-center"><?php echo $sum_money;?></td>
            <td class="am-hide-sm-only am-text-center"><?php echo $sum2_orders;?></td>
            <td class="am-hide-sm-only am-text-center"><?php echo $sum2_players.'('.$sum2_players2.')' . '('.$sum2_players3.')';?></td>
            <td class="am-hide-sm-only am-text-center"><?php echo $sum2_yb;?></td>
            <td class="am-text-center"><?php echo $sum2_money;?></td>
        </tr>

        </tbody>
    </table>
</div>



<script type="text/javascript">

	$(function() {

		$('table').tablesort().data('tablesort');
		$('thead th.number').data('sortBy', function(th, td, sorter) {
			return parseInt(td.text(), 10);
		});

	});

</script>

<?php $this->endBlock('content');?>
